# RGB-D Multi-Point Detection (v1.3.1)

ğŸ“… Updated: 2025-06-09

æœ¬é¡¹ç›®åŸºäº DFormer ä¸»å¹²ç½‘ç»œï¼Œå®ç°äº†å¤šç‚¹ RGB+Depth å…³é”®ç‚¹æ£€æµ‹ä»»åŠ¡ï¼Œå…·å¤‡é«˜æ–¯çƒ­å›¾ç›‘ç£ã€åæ ‡è§£ç ã€è”åˆæŸå¤±ä¼˜åŒ–ã€PCK/OKS è¯„ä¼°åŠå¯è§†åŒ–åŠŸèƒ½ï¼Œé…ç½®çµæ´»ã€‚

<img src="outputs\pred_Image__Rgb_54_point1_aug1.png" style="zoom:33%;" />

---

## ğŸ“ ä¸€ã€é¡¹ç›®æ¨¡å—åˆ’åˆ†

```plaintext
ä»£ç ä¸»è¦æ¨¡å—ï¼š
â”œâ”€â”€ config/           # æ‰€æœ‰è®­ç»ƒã€æ¨¡å‹ã€æ•°æ®å‚æ•°é›†ä¸­é…ç½®
â”œâ”€â”€ data/             # æ•°æ®å¢å¼ºã€çƒ­å›¾ç”Ÿæˆã€å¤šç‚¹æ•°æ®é›†å®šä¹‰
â”œâ”€â”€ models/           # DFormer ä¸»å¹² + æ£€æµ‹å¤´ + å®Œæ•´ç»“æ„å°è£…
â”œâ”€â”€ losses/           # çƒ­å›¾æŸå¤± + åæ ‡æŸå¤± + è”åˆæŸå¤±
â”œâ”€â”€ utils/            # PCKã€OKSã€å¯è§†åŒ–å·¥å…·
â”œâ”€â”€ train.py          # ä¸»è®­ç»ƒå…¥å£ï¼Œè‡ªåŠ¨åŠ è½½é…ç½®å¹¶è®­ç»ƒ
```

---

## ğŸ§  äºŒã€æ¨¡å‹ç»“æ„æè¿°

```plaintext
æ•´ä½“ç»“æ„ï¼š
[RGB + Depth è¾“å…¥]
        â†“
    DFormer ç¼–ç å™¨ï¼ˆTransformerï¼‰
        â†“
   Feature Map (B, C, H, W)
        â†“
   HeatmapHeadï¼š
     - ä¸Šé‡‡æ · Ã—2ï¼ˆConvTranspose2dï¼‰
     - 1x1 å·ç§¯è¾“å‡º num_points ä¸ªé€šé“
        â†“
   çƒ­å›¾ (B, num_points, 256, 256)
        â†“
   Softmax weighted average â†’ åæ ‡è¾“å‡º
```

æ”¯æŒè”åˆè¾“å‡ºï¼š

* çƒ­å›¾ (ç›‘ç£ç”¨)
* å½’ä¸€åŒ–åæ ‡ (è¯„ä¼°ç”¨)

---

## âš™ï¸ ä¸‰ã€è®­ç»ƒé…ç½®ï¼ˆé›†ä¸­äº `config/config.py`ï¼‰

| é…ç½®é¡¹           | ç¤ºä¾‹å€¼ / æè¿°                                          |
| ---------------- | ------------------------------------------------------ |
| å›¾åƒå°ºå¯¸         | `image_size=(256, 256)`                                |
| å…³é”®ç‚¹æ•°         | `num_points=1`                                         |
| é«˜æ–¯æ ¸æ ‡å‡†å·® Ïƒ   | `gaussian_sigma=3.0`                                   |
| æ¨¡å‹ç»“æ„         | `cfg_name='local_configs.NYUDepthv2.DFormerv2_L'`      |
| é¢„è®­ç»ƒæƒé‡è·¯å¾„   | `'checkpoints/pretrained/DFormerv2_Large_NYU.pth'`     |
| è®­ç»ƒé›†CSV        | `'dataset/train.csv'`                                  |
| RGB/æ·±åº¦å›¾ç›®å½•   | `'dataset/rgb'`, `'dataset/depth'`                     |
| è”åˆæŸå¤±æƒé‡     | `heatmap_weight=1.0`, `coord_weight=0.1`               |
| æ‰¹å¤§å°           | `batch_size=16`                                        |
| æ€»è®­ç»ƒè½®æ•°       | `total_epochs=100`                                     |
| å†»ç»“ç¼–ç å™¨è½®æ•°   | `freeze_epochs=70`                                     |
| å­¦ä¹ ç‡é…ç½®       | `lr_encoder=1e-5`, `lr_head=5e-4`, `weight_decay=1e-4` |
| å­¦ä¹ ç‡è°ƒåº¦å™¨     | `CosineAnnealingLR`, `T_max=30`                        |
| æ¨¡å‹ä¿å­˜ç­–ç•¥     | `save_best_by='pck'`, `save_last=True`                 |
| å¯è§†åŒ–å‘¨æœŸä¸è·¯å¾„ | æ¯ `5` è½® â†’ `outputs/visualizations/`                  |
| æ¨¡å‹ä¿å­˜è·¯å¾„     | `best_model_path='outputs/best_model.pth'` ç­‰          |

---

## ğŸ§ª å››ã€æŸå¤±å‡½æ•°è®¾è®¡

| ç±»å‹   | å®ç°æ–¹å¼                       | æè¿°          | æƒé‡  |
| ---- | -------------------------- | ----------- | --- |
| çƒ­å›¾æŸå¤± | `MSELoss(reduction='sum')` | æ¯ä¸ªå…³é”®ç‚¹çš„çƒ­å›¾ç›‘ç£  | 1.0 |
| åæ ‡æŸå¤± | `SmoothL1Loss` + åå½’ä¸€åŒ–      | åæ ‡é¢„æµ‹åœ¨åŸå›¾ä¸Šçš„è¯¯å·® | 0.1 |
| è”åˆæŸå¤± | `HeatmapLoss + CoordLoss`  | æœ€ç»ˆæ€»æŸå¤±       | -   |

---

## ğŸ§± äº”ã€æ•°æ®å¢å¼ºç­–ç•¥

| æ“ä½œ       | å‚æ•° / èŒƒå›´            | ä½œç”¨      |
| -------- | ------------------ | ------- |
| æ°´å¹³ç¿»è½¬     | 50% æ¦‚ç‡             | å¢å¼ºå·¦å³å¯¹ç§°  |
| å‚ç›´ç¿»è½¬     | 50% æ¦‚ç‡             | å¢å¼ºä¸Šä¸‹å¯¹ç§°  |
| éšæœºæ—‹è½¬     | Â±15Â°ï¼Œ50% æ¦‚ç‡        | å¢å¼ºæ—‹è½¬ä¸å˜æ€§ |
| äº®åº¦/å¯¹æ¯”åº¦è°ƒæ•´ | \[0.8, 1.2]ï¼Œ50% æ¦‚ç‡ | æé«˜å…‰ç…§é²æ£’æ€§ |

---

## ğŸ“Š å…­ã€è®­ç»ƒæŒ‡æ ‡

| æŒ‡æ ‡åç§°  | è®­ç»ƒé›† | éªŒè¯é›† | è¯´æ˜                          |
| --------- | ------ | ------ | ----------------------------- |
| è”åˆæŸå¤±  | 7.82   | 10.095 | è¶Šä½è¶Šå¥½                      |
| PCK\@0.05 | 0.9212 | 0.9166 | è·ç¦»çœŸå®ç‚¹<5%å›¾åƒå®½åº¦çš„ç‚¹æ¯”ä¾‹ |
| OKS       | 0.9256 | 0.9235 | çƒ­å›¾é‡åˆåº¦ç›¸ä¼¼æ€§              |

> æ³¨ï¼švalä¸­çš„å·¥ä»¶åœ¨è®­ç»ƒä¸­è§è¿‡

---

## ğŸš€ ä¸ƒã€ä½¿ç”¨æ–¹æ³•

### 1. å®‰è£…ä¾èµ–

```bash
pip install mmcv-full -f https://download.openmmlab.com/mmcv/dist/cu118/torch2.0/index.html
pip install -r requirements.txt
```

> å¦‚ä½¿ç”¨æœ¬åœ° DFormerï¼ˆåŒ…å« `mmseg/`ï¼‰ï¼Œéœ€åœ¨ `train.py` é¡¶éƒ¨åŠ å…¥ï¼š
>
> ```python
> sys.path.append("DFormer")
> ```

---

### 2. è®­ç»ƒæ¨¡å‹

```bash
python train.py
```

å°†ä¼šï¼š

* è‡ªåŠ¨åŠ è½½é…ç½®
* ä¿å­˜å¯è§†åŒ–ç»“æœäº `outputs/visualizations/`
* æŒ‰ `config["save_best_by"]` ç­–ç•¥ä¿å­˜æ¨¡å‹

---

### 3. å¯è§†åŒ–è¾“å‡º

* çƒ­å›¾ã€é¢„æµ‹ç‚¹ã€GT ç‚¹å°†å¯è§†åŒ–ä¿å­˜æ¯ `n` è½®
* å›¾åƒä½äº `outputs/visualizations/epoch_*.png`

---

## ğŸ§¬ å…«ã€ä¼ªä»£ç ï¼ˆè®­ç»ƒæµç¨‹ï¼‰

```python
åŠ è½½é…ç½® â†’ åˆå§‹åŒ–æ¨¡å‹ â†’ åŠ è½½é¢„è®­ç»ƒæƒé‡
å†»ç»“ç¼–ç å™¨ï¼ˆå‰ N è½®ï¼‰
for epoch in range(total_epochs):
    è§£å†»ç¼–ç å™¨ï¼ˆå¯é€‰ï¼‰
    for batch in train_loader:
        â†’ æ¨¡å‹å‰å‘ + æŸå¤±è®¡ç®— + åå‘ä¼ æ’­
    for batch in val_loader:
        â†’ è¯„ä¼° PCKã€OKS
        â†’ æ¯ N è½®ä¿å­˜å¯è§†åŒ–
    è‹¥å½“å‰æŒ‡æ ‡æœ€ä¼˜ â†’ ä¿å­˜æ¨¡å‹
    è‹¥ä¸ºæœ€åä¸€è½® â†’ ä¿å­˜æœ€ç»ˆæ¨¡å‹ï¼ˆå¯é€‰ï¼‰
```

---

## ğŸ§  ä¹ã€å¤‡æ³¨ä¸æ‰©å±•å»ºè®®

* [ ] æ”¯æŒå¤šç‚¹æ ‡æ³¨ï¼ˆnum\_points > 1ï¼‰
* [ ] æ·»åŠ  `test.py` è¿›è¡Œå•å¼ å›¾åƒæ¨ç†
* [ ] æ”¯æŒ `yaml` æˆ– `argparse` åŠ¨æ€é…ç½®

---

## ğŸ“ å¼•ç”¨ä¸å‚è€ƒ

* [DFormer: Transformer-Based RGB-D Segmentation](https://github.com/zcablii/DFormer)
* [MMSegmentation](https://github.com/open-mmlab/mmsegmentation)


